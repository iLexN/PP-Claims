{# empty Twig template #}
<h1>Upload a file</h1>
<form method="POST" action="{{ path_for('upload') }}" enctype="multipart/form-data" id='f'>
    <label>Select file to upload:</label>
    <input id="f1" type="file" name="newfile" accept=
           "application/pdf, image/jpeg, image/png" multiple>
    <input type="file" name="newfile2">
    <input type="text" name="doreme" value="doreme">
    <button type="submit">Upload</button>
    <button type="button" class='jsAjaxUpload'>ajax Upload</button>
</form>

    <div id="p">0%</div>
    <div id="h" style="background-color: #000;width:0;height:20px;"></div>
    
<div style="color:red">{{ errorMsg | join(',') }}</div>

<div>
    <a href="{{ path_for('downlaodFile', {"filename": filename} ) }}">{{ filename }}</a>
</div>

<script src="{{ base_url() }}/assets/components/jquery/dist/jquery.min.js" type="text/javascript"></script>
<script>
    
    
    
    $(".jsAjaxUpload").on('click', function () {
        var form = $("#f")[0];
        var formData = new FormData(form);
        
        console.log(form);
        
        if ( form[0].files[0].size > 2000000 ) {
            console.log('File size too big' + form[0].files[0].size);
            //return ;
        }
        $.ajax({
            beforeSend: function () {
                // Show modal
                //$("#modal_system").modal('show');       
            },
            url: '{{ path_for('upload') }}',
            type: 'POST',
            data: formData,
            contentType: false,
            processData: false,
            //dataType: "json"
            xhr: function () {
                myXhr = $.ajaxSettings.xhr();
                if (myXhr.upload) {
                    myXhr.upload.addEventListener('progress', function (e) {
                        var loaded = e.loaded;
                        var total = e.total;
                        var percentComplete = Math.round((e.loaded / e.total) * 100);
                        $('#h').css('width', percentComplete + '%');
                        $('#p').html(percentComplete + '%');

                    }, false);
                    myXhr.upload.addEventListener('load', function (e) {
                        // After upload cant reset progrees bar
                        //$('.progress .progress-bar').css('width', '0%');
                        //$('.progress .progress-bar').html( '');
                    }, false);
                }
                return myXhr;
            }
        }).done(function (data, textStatus, jqXHR) {
            console.log(data);
        }).fail(function (jqXHR, textStatus, errorThrown) {
            console.info('try again');
            console.log(errorThrown);
            console.log(textStatus);
        });
    });
</script>
