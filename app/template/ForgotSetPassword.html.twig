{% extends "template/s1.html.twig" %}
{% block centerBlock %}
    <form action="" method="POST">
        <p>    
            <label for="username">Username:</label>
            <span>{{ User.user_name }}</span>
        </p>
        <p>
            <label for="pswd">New Password:</label>
            <span><input data-jshook="password1 checkPass" type="password" name="pswd" /></span>
        </p>
        <p>
            <label for="pswd2">confirm Password:</label>
            <span><input data-jshook="password2 checkPass" type="password" name="pswd2" /></span>
        </p>
        <p>
            <button data-jshook="SignUpBtn" type="submit" disabled="disabled">Set New Password</button></p>
        


        {% include 'include/csrf.twig' %}
    </form>

    <div data-jshook="passCheckInfo" class="hidden">
        <h4>Password must meet the following requirements:</h4>
        <ul>
            <li data-jshook="Letter" class="invalid">At least <strong>one Case Diff letter</strong></li>
            <li data-jshook="Number" class="invalid">At least <strong>one number</strong></li>
            <li data-jshook="Length" class="invalid">Be at least <strong>8 characters</strong></li>
            <li data-jshook="PassSame" class="invalid">confirm password</li>
        </ul>
    </div>
{% endblock %}

{% block jsBottom %}
    {{ parent() }}
    <script>
        $(function () {
            'use strict';
            var SignUpControl = (function () {
                //todo:check username dupe?
                // need ajax? so here otherwise move to *.js 
                var $jsPassInfo = $.jshook('passCheckInfo');
                var $btn = $.jshook('SignUpBtn');
                var $length = $.jshook('Length');
                var $letter = $.jshook('Letter');
                var $num = $.jshook('Number');
                var $passSame = $.jshook('PassSame');
                var validCssClass = 'valid';
                var inValidCssClass = 'invalid';

                var passwordModule = createpasswordModule();

                function setP1() {
                    passwordModule.setP1($(this).val());
                }
                function setP2() {
                    passwordModule.setP2($(this).val());
                }
                function valid($obj) {
                    $obj.removeClass(inValidCssClass).addClass(validCssClass);
                }
                function inValid($obj) {
                    $obj.removeClass(validCssClass).addClass(inValidCssClass);
                }
                function check() {
                    if (passwordModule.isLenghtPass(8)) {
                        valid($length);
                    } else {
                        inValid($length);
                    }
                    if (passwordModule.hasUpperCase() && passwordModule.hasLowerCase()) {
                        valid($letter);
                    } else {
                        inValid($letter);
                    }
                    if (passwordModule.hasNumber()) {
                        valid($num);
                    } else {
                        inValid($num);
                    }
                    if (passwordModule.isPassSame()) {
                        valid($passSame);
                    } else {
                        inValid($passSame);
                    }
                    if ($jsPassInfo.find('li').hasClass('invalid') === false) {
                        $btn.prop("disabled", false);
                    } else {
                        $btn.prop("disabled", true);
                    }
                }
                function infoShow() {
                    $jsPassInfo.show();
                }
                function infoHide() {
                    $jsPassInfo.hide();
                }
                return {
                    setP1: setP1,
                    setP2: setP2,
                    check: check,
                    infoShow: infoShow,
                    infoHide: infoHide
                };
            })();
            //setup dom event
            
            $.jshook('password1').on({
                'keyup.set': SignUpControl.setP1,
                focus: SignUpControl.infoShow,
                blur: SignUpControl.infoHide,
                paste: false
            });
            $.jshook('password2').on({
                'keyup.set': SignUpControl.setP2,
                focus: SignUpControl.infoShow,
                blur: SignUpControl.infoHide,
                paste: false
            });
            $.jshook('checkPass').on({
                'keyup.check': SignUpControl.check
            });
            
        });
    </script>
{% endblock %}
